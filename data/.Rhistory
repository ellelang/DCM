newbetas[5:16]
n_draws <- 10000
newbetas<- betas
#newbetas$Betas <- as.vector(rmvnorm(1,mean = betas$Betas, sigma = varcov_m))
descrip(dataset)
rm(list = ls())
library(uwIntroStats)
library(tidyverse)
library(mvtnorm)
setwd("C:/Users/langzx/Desktop/github/DCM/data")
dataset <- read.csv (file = "county_all0426.csv",header = TRUE)
dim(dataset)
n <- dim(dataset)[1]
dataset$asc <- rep(1,n )
dataset$lake1000 <- dataset$implakes/1000
colnames(dataset)
betas <- read.csv("beta_county.csv", header = TRUE)
varcov <- read.csv("varcov_county.csv",  header = FALSE)
dim(varcov)
varcov_m <- as.matrix(varcov, nrow = 16, ncol = 16)
varcov_m
betas$Names
betas$Betas
newbetas<- betas
#newbetas$Betas <- as.vector(rmvnorm(1,mean = betas$Betas, sigma = varcov_m))
descrip(dataset)
## Payment
pay_rp <- newbetas$Betas[newbetas$Names=="pay"]
## wetland
wld_rp <- newbetas$Betas[newbetas$Names=="wetland"]
## cc
cc_rp <- newbetas$Betas[newbetas$Names=="cc"]
lake_rp <- newbetas$Betas[newbetas$Names=="cclake"]
## nm
nm_rp <- newbetas$Betas[newbetas$Names=="nm"]
length(newbetas$Names)
dataset$asc <- rep(1,n )
dataset$Wetland <- rep(1,n )
dataset$Payment <- rep(1,n )
dataset$Covercrop<- rep(1,n )
dataset$NuMgt <- rep(1,n )
colnames(dataset)
newbetas<- betas
#newbetas$Betas <- as.vector(rmvnorm(1,mean = betas$Betas, sigma = varcov_m))
descrip(dataset)
# coeff
## Payment
pay_rp <- newbetas$Betas[newbetas$Names=="pay"]
## wetland
wld_rp <- newbetas$Betas[newbetas$Names=="wetland"]
## cc
cc_rp <- newbetas$Betas[newbetas$Names=="cc"]
lake_rp <- newbetas$Betas[newbetas$Names=="cclake"]
## nm
nm_rp <- newbetas$Betas[newbetas$Names=="nm"]
length(newbetas$Names)
## fixed parameters
#new_beta2<- c(0,0,0,0,newbetas$Betas[5:17],0)
dat0 <- select (dataset, Wetland, Payment, Covercrop, NuMgt, asc,
dflall,taxcost,
income1, income23, income4, income5, income6,
areaf1, areaf2, areaf3, areaf4, lake1000)
dat0 <- select (dataset, Wetland, Payment, Covercrop, NuMgt, asc,
dflall,taxcost,
income1, income23, income4, income5, income6,
area2, area3, area4, lake1000)
############INDIVIDUAL WTA estimate EXAMPLE
draws <- matrix (NA,nrow = 10, ncol = 16)
colnames(draws)<-c('wetland','pay','cc','nm','asc','dfl','costtax',
'inc1','inc23','inc4','inc5','inc6',
'farm2','farm3','farm4','cclake')
for (r1 in 1 : 10){
drawbetas<- betas
drawbetas$Betas <- as.vector(rmvnorm(1,mean = betas$Betas, sigma = varcov_m))
draws[r1, ] <- drawbetas$Betas
}
draws
draws[1,"pay"]
newbetas <- draws[1,]
newbetas["pay"]
newbetas[5:16]
n_draws <- 10000
## fixed parameters
new_beta2<- c(0,0,0,0,newbetas$Betas[5:15],0)
dat0 <- select (dataset, Wetland, Payment, Covercrop, NuMgt, asc,
dflall,taxcost,
income1, income23, income4, income5, income6,
area2, area3, area4, lake1000)
############INDIVIDUAL WTA estimate EXAMPLE
draws <- matrix (NA,nrow = 10, ncol = 16)
colnames(draws)<-c('wetland','pay','cc','nm','asc','dfl','costtax',
'inc1','inc23','inc4','inc5','inc6',
'farm2','farm3','farm4','cclake')
for (r1 in 1 : 10){
drawbetas<- betas
drawbetas$Betas <- as.vector(rmvnorm(1,mean = betas$Betas, sigma = varcov_m))
draws[r1, ] <- drawbetas$Betas
}
draws
draws[1,"pay"]
newbetas <- draws[1,]
newbetas["pay"]
newbetas[5:16]
n_draws <- 10000
wta_wld <- -(wld_rp) + as.vector(dat_m %*% new_beta2) / pay_rp
mean(wta_wld, na.rm = TRUE)
plot(density(wtp_wld))
wta_wld
for (r1 in 1 : 10){
drawbetas<- betas
drawbetas$Betas <- as.vector(rmvnorm(1,mean = betas$Betas, sigma = varcov_m))
draws[r1, ] <- drawbetas$Betas
}
draws
## individual sample
dat1 <- sample_n(dat0, 1)
dat1
dat_m <- as.matrix(x = dat1, nrow = 1, ncol = 16)
dat_m
draws <- matrix (NA,nrow = 10, ncol = 16)
colnames(draws)<-c('wetland','pay','cc','nm','asc','dfl','costtax',
'inc1','inc23','inc4','inc5','inc6',
'farm2','farm3','farm4','cclake')
for (r1 in 1 : 10){
drawbetas<- betas
drawbetas$Betas <- as.vector(rmvnorm(1,mean = betas$Betas, sigma = varcov_m))
draws[r1, ] <- drawbetas$Betas
}
draws
draws[1,"pay"]
newbetas <- draws[1,]
newbetas["pay"]
newbetas[5:15]
n_draws <- 10000
wta_wld <- -(wld_rp) + as.vector(dat_m %*% new_beta2) / pay_rp
mean(wta_wld, na.rm = TRUE)
plot(density(wtp_wld))
wta_wld
wta_wld <- -(wld_rp) + as.vector(dat_m %*% new_beta2) / pay_rp
## fixed parameters
new_beta2<- c(0,0,0,0,newbetas$Betas[5:15],0)
newbetas<- betas
## fixed parameters
new_beta2<- c(0,0,0,0,newbetas[5:15],0)
## fixed parameters
new_beta2<- c(0,0,0,0,newbetas$Betas[5:15],0)
dat0 <- select (dataset, Wetland, Payment, Covercrop, NuMgt, asc,
dflall,taxcost,
income1, income23, income4, income5, income6,
area2, area3, area4, lake1000)
wta_wld <- -(wld_rp) + as.vector(dat_m %*% new_beta2) / pay_rp
mean(wta_wld, na.rm = TRUE)
plot(density(wtp_wld))
draws
newbetas[5:15]
newbetas$Betas[5:15]
n_draws <- 10000
dat_m %*% new_beta2
wld_rp
# coeff
## Payment
pay_rp <- newbetas$Betas[newbetas$Names=="pay"]
pay_rp
## wetland
wld_rp <- newbetas$Betas[newbetas$Names=="wetland"]
wld_rp
## wetland
wld_rp <- newbetas$Betas[newbetas$Names=="Wetland"]
wld_rp
## wetland
wld_rp <- newbetas$Betas[newbetas$Names=="wetlands"]
wld_rp
## cc
cc_rp <- newbetas$Betas[newbetas$Names=="cc"]
cc_rp
lake_rp <- newbetas$Betas[newbetas$Names=="cclake"]
lake_rp
## nm
nm_rp <- newbetas$Betas[newbetas$Names=="nm"]
nm_rp
wta_wld <- -(wld_rp) + as.vector(dat_m %*% new_beta2) / pay_rp
mean(wta_wld, na.rm = TRUE)
plot(density(wtp_wld))
wta_wld <- -(wld_rp) + as.vector(dat_m %*% new_beta2) / pay_rp
wta_wld
################## FOR WHOLE SAMPLE
#set.seed(123456)
R <- 1000
n <- dim(dataset)[1]
t <- 1
s<- 30
s<- 44
index <- seq(1, n, by=1)
length(index)
n_draws <- 1000
WLD_WTA_ALL <- matrix(NA, nrow = s, ncol = 3)
colnames(WLD_WTA_ALL) <- c("MEAN", "CI_L","CI_U")
for (i in 1:s){
wta_vec <- vector (length = R)
draws <- matrix (NA,nrow = R, ncol = 18)
colnames(draws)<-c('wetland','pay','cc','nm','asc','dfl','costtax',
'inc1','inc23','inc4','inc5','inc6',
'farm2','farm3','farm4','cclake')
set.seed(4008)
for (r1 in 1 : R){
drawbetas<- betas
drawbetas$Betas <- as.vector(rmvnorm(1,mean = betas$Betas, sigma = varcov_m))
draws[r1, ] <- drawbetas$Betas
}
for (r in 1 : R){
newbetas <- draws[r,]
pay_rp <- newbetas["pay"]
wld_rp <- newbetas["wetlands"]
## individual-specific parameters
new_beta2<- c(0,0,0,0,newbetas[5:15],0)
index_i <- index [i]
dat_s <- dat0[i,]
dat_s_m <- as.matrix(x = dat_s, nrow = 1, ncol = 16)
wta_s <- -(wld_rp + as.vector(dat_s_m %*% new_beta2)) / pay_rp
wta_vec[r] <- mean(wta_s,na.rm = TRUE)
}
WLD_WTA_ALL[i,1] <- mean(wta_vec,na.rm = TRUE)
WLD_WTA_ALL[i,2] <- quantile(wta_vec, 0.025,na.rm = TRUE)
WLD_WTA_ALL[i,3] <- quantile(wta_vec, 0.975,na.rm = TRUE)
}
WLD_WTA_ALL
##########wld wta
WLD_WTA_ALL <- matrix(NA, nrow = s, ncol = 3)
colnames(WLD_WTA_ALL) <- c("MEAN", "CI_L","CI_U")
for (i in 1:s){
wta_vec <- vector (length = R)
draws <- matrix (NA,nrow = R, ncol = 16)
colnames(draws)<-c('wetland','pay','cc','nm','asc','dfl','costtax',
'inc1','inc23','inc4','inc5','inc6',
'farm2','farm3','farm4','cclake')
set.seed(4008)
for (r1 in 1 : R){
drawbetas<- betas
drawbetas$Betas <- as.vector(rmvnorm(1,mean = betas$Betas, sigma = varcov_m))
draws[r1, ] <- drawbetas$Betas
}
for (r in 1 : R){
newbetas <- draws[r,]
pay_rp <- newbetas["pay"]
wld_rp <- newbetas["wetlands"]
## individual-specific parameters
new_beta2<- c(0,0,0,0,newbetas[5:15],0)
index_i <- index [i]
dat_s <- dat0[i,]
dat_s_m <- as.matrix(x = dat_s, nrow = 1, ncol = 16)
wta_s <- -(wld_rp + as.vector(dat_s_m %*% new_beta2)) / pay_rp
wta_vec[r] <- mean(wta_s,na.rm = TRUE)
}
WLD_WTA_ALL[i,1] <- mean(wta_vec,na.rm = TRUE)
WLD_WTA_ALL[i,2] <- quantile(wta_vec, 0.025,na.rm = TRUE)
WLD_WTA_ALL[i,3] <- quantile(wta_vec, 0.975,na.rm = TRUE)
}
WLD_WTA_ALL
n
t <- 1
s<- 44
WLD_WTA_ALL <- matrix(NA, nrow = s, ncol = 3)
colnames(WLD_WTA_ALL) <- c("MEAN", "CI_L","CI_U")
for (i in 1:s){
wta_vec <- vector (length = R)
draws <- matrix (NA,nrow = R, ncol = 16)
colnames(draws)<-c('wetland','pay','cc','nm','asc','dfl','costtax',
'inc1','inc23','inc4','inc5','inc6',
'farm2','farm3','farm4','cclake')
set.seed(4008)
for (r1 in 1 : R){
drawbetas<- betas
drawbetas$Betas <- as.vector(rmvnorm(1,mean = betas$Betas, sigma = varcov_m))
draws[r1, ] <- drawbetas$Betas
}
for (r in 1 : R){
newbetas <- draws[r,]
pay_rp <- newbetas["pay"]
wld_rp <- newbetas["wetlands"]
## individual-specific parameters
new_beta2<- c(0,0,0,0,newbetas[5:15],0)
index_i <- index [i]
dat_s <- dat0[i,]
dat_s_m <- as.matrix(x = dat_s, nrow = 1, ncol = 16)
wta_s <- -(wld_rp + as.vector(dat_s_m %*% new_beta2)) / pay_rp
wta_vec[r] <- mean(wta_s,na.rm = TRUE)
}
WLD_WTA_ALL[i,1] <- mean(wta_vec,na.rm = TRUE)
WLD_WTA_ALL[i,2] <- quantile(wta_vec, 0.025,na.rm = TRUE)
WLD_WTA_ALL[i,3] <- quantile(wta_vec, 0.975,na.rm = TRUE)
}
WLD_WTA_ALL
R <- 10
n <- dim(dataset)[1]
n
t <- 1
s<- 44
index <- seq(1, n, by=1)
length(index)
n_draws <- 10
set.seed(123456)
R <- 1
n <- dim(dataset)[1]
n
t <- 1
s<- 44
index <- seq(1, n, by=1)
length(index)
n_draws <- 1
WLD_WTA_ALL <- matrix(NA, nrow = s, ncol = 3)
colnames(WLD_WTA_ALL) <- c("MEAN", "CI_L","CI_U")
## individual sample
dat1 <- sample_n(dat0, 1)
dat1
dat_m <- as.matrix(x = dat1, nrow = 1, ncol = 16)
dat_m
draws <- matrix (NA,nrow = 10, ncol = 16)
colnames(draws)<-c('wetland','pay','cc','nm','asc','dfl','costtax',
'inc1','inc23','inc4','inc5','inc6',
'farm2','farm3','farm4','cclake')
for (r1 in 1 : 10){
drawbetas<- betas
drawbetas$Betas <- as.vector(rmvnorm(1,mean = betas$Betas, sigma = varcov_m))
draws[r1, ] <- drawbetas$Betas
}
draws
draws[1,"pay"]
newbetas <- draws[1,]
newbetas["pay"]
newbetas[5:15]
new_beta2 <- newbetas[5:15]
wta_wld <- -(wld_rp) + as.vector(dat_m %*% new_beta2) / pay_rp
dat_m %*% new_beta2
dat_m
dim(dat_m)
new_beta2 <- c(0,0,0,0,newbetas[5:15],0)
dat_m %*% new_beta2
n_draws <- 10000
wta_wld <- -(wld_rp) + as.vector(dat_m %*% new_beta2) / pay_rp
wta_wld
as.vector(dat_m %*% new_beta2)
wld_rp
## wetland
wld_rp <- newbetas$Betas[newbetas$Names=="wetlands"]
wld_rp
dataset <- read.csv (file = "county_all0426.csv",header = TRUE)
dim(dataset)
n <- dim(dataset)[1]
dataset$asc <- rep(1,n )
dataset$Wetland <- rep(1,n )
dataset$Payment <- rep(1,n )
dataset$Covercrop<- rep(1,n )
dataset$NuMgt <- rep(1,n )
dataset$lake1000 <- dataset$implakes/1000
colnames(dataset)
betas <- read.csv("beta_county.csv", header = TRUE)
varcov <- read.csv("varcov_county.csv",  header = FALSE)
dim(varcov)
varcov_m <- as.matrix(varcov, nrow = 16, ncol = 16)
varcov_m
betas$Names
betas$Betas
newbetas<- betas
newbetas$Betas
# coeff
## Payment
pay_rp <- newbetas$Betas[newbetas$Names=="pay"]
pay_rp
## wetland
wld_rp <- newbetas$Betas[newbetas$Names=="wetlands"]
wld_rp
## cc
cc_rp <- newbetas$Betas[newbetas$Names=="cc"]
cc_rp
lake_rp <- newbetas$Betas[newbetas$Names=="cclake"]
lake_rp
## nm
nm_rp <- newbetas$Betas[newbetas$Names=="nm"]
nm_rp
dat0 <- select (dataset, Wetland, Payment, Covercrop, NuMgt, asc,
dflall,taxcost,
income1, income23, income4, income5, income6,
area2, area3, area4, lake1000)
## individual sample
dat1 <- sample_n(dat0, 1)
dat1
dat_m <- as.matrix(x = dat1, nrow = 1, ncol = 16)
dim(dat_m)
draws <- matrix (NA,nrow = 10, ncol = 16)
colnames(draws)<-c('wetland','pay','cc','nm','asc','dfl','costtax',
'inc1','inc23','inc4','inc5','inc6',
'farm2','farm3','farm4','cclake')
for (r1 in 1 : 10){
drawbetas<- betas
drawbetas$Betas <- as.vector(rmvnorm(1,mean = betas$Betas, sigma = varcov_m))
draws[r1, ] <- drawbetas$Betas
}
draws
as.vector(dat_m %*% new_beta2)
wld_rp
draws[1,"pay"]
newbetas <- draws[1,]
newbetas["pay"]
new_beta2 <- c(0,0,0,0,newbetas[5:15],0)
dat_m %*% new_beta2
n_draws <- 10000
wta_wld <- -(wld_rp + as.vector(dat_m %*% new_beta2) )/ pay_rp
wta_wld
mean(wta_wld, na.rm = TRUE)
n
R <- 10
n <- dim(dataset)[1]
n
WLD_WTA_ALL <- matrix(NA, nrow = n, ncol = 3)
colnames(WLD_WTA_ALL) <- c("MEAN", "CI_L","CI_U")
for (i in 1:n){
wta_vec <- vector (length = R)
draws <- matrix (NA,nrow = R, ncol = 16)
colnames(draws)<-c('wetland','pay','cc','nm','asc','dfl','costtax',
'inc1','inc23','inc4','inc5','inc6',
'farm2','farm3','farm4','cclake')
set.seed(4008)
for (r1 in 1 : R){
drawbetas<- betas
drawbetas$Betas <- as.vector(rmvnorm(1,mean = betas$Betas, sigma = varcov_m))
draws[r1, ] <- drawbetas$Betas
}
for (r in 1 : R){
newbetas <- draws[r,]
pay_rp <- newbetas["pay"]
wld_rp <- newbetas["wetlands"]
## individual-specific parameters
new_beta2<- c(0,0,0,0,newbetas[5:15],0)
dat_s <- dat0[i,]
dat_s_m <- as.matrix(x = dat_s, nrow = 1, ncol = 16)
wta_s <- -(wld_rp + as.vector(dat_s_m %*% new_beta2)) / pay_rp
wta_vec[r] <- mean(wta_s,na.rm = TRUE)
}
WLD_WTA_ALL[i,1] <- mean(wta_vec,na.rm = TRUE)
WLD_WTA_ALL[i,2] <- quantile(wta_vec, 0.025,na.rm = TRUE)
WLD_WTA_ALL[i,3] <- quantile(wta_vec, 0.975,na.rm = TRUE)
}
WLD_WTA_ALL
newbetas
wta_vec
wta_s
dat_s_m %*% new_beta2
wld_rp
#set.seed(123456)
R <- 10
n <- dim(dataset)[1]
n
WLD_WTA_ALL <- matrix(NA, nrow = n, ncol = 3)
colnames(WLD_WTA_ALL) <- c("MEAN", "CI_L","CI_U")
for (i in 1:n){
wta_vec <- vector (length = R)
draws <- matrix (NA,nrow = R, ncol = 16)
colnames(draws)<-c('wetlands','pay','cc','nm','asc','dfl','costtax',
'inc1','inc23','inc4','inc5','inc6',
'farm2','farm3','farm4','cclake')
set.seed(4008)
for (r1 in 1 : R){
drawbetas<- betas
drawbetas$Betas <- as.vector(rmvnorm(1,mean = betas$Betas, sigma = varcov_m))
draws[r1, ] <- drawbetas$Betas
}
for (r in 1 : R){
newbetas <- draws[r,]
pay_rp <- newbetas["pay"]
wld_rp <- newbetas["wetlands"]
## individual-specific parameters
new_beta2<- c(0,0,0,0,newbetas[5:15],0)
dat_s <- dat0[i,]
dat_s_m <- as.matrix(x = dat_s, nrow = 1, ncol = 16)
wta_s <- -(wld_rp + as.vector(dat_s_m %*% new_beta2)) / pay_rp
wta_vec[r] <- mean(wta_s,na.rm = TRUE)
}
WLD_WTA_ALL[i,1] <- mean(wta_vec,na.rm = TRUE)
WLD_WTA_ALL[i,2] <- quantile(wta_vec, 0.025,na.rm = TRUE)
WLD_WTA_ALL[i,3] <- quantile(wta_vec, 0.975,na.rm = TRUE)
}
WLD_WTA_ALL
plot(density(WLD_WTA_ALL[,1]))
WLD_WTA_ALL <- matrix(NA, nrow = n, ncol = 3)
colnames(WLD_WTA_ALL) <- c("MEAN", "CI_L","CI_U")
for (i in 1:n){
wta_vec <- vector (length = R)
draws <- matrix (NA,nrow = R, ncol = 16)
colnames(draws)<-c('wetlands','pay','cc','nm','asc','dfl','costtax',
'inc1','inc23','inc4','inc5','inc6',
'farm2','farm3','farm4','cclake')
set.seed(4008)
for (r1 in 1 : R){
drawbetas<- betas
drawbetas$Betas <- as.vector(rmvnorm(1,mean = betas$Betas, sigma = varcov_m))
draws[r1, ] <- drawbetas$Betas
}
for (r in 1 : R){
newbetas <- draws[r,]
pay_rp <- newbetas["pay"]
wld_rp <- newbetas["wetlands"]
## individual-specific parameters
new_beta2<- c(0,0,0,0,newbetas[5:15],0)
dat_s <- dat0[i,]
dat_s_m <- as.matrix(x = dat_s, nrow = 1, ncol = 16)
wta_vec[r] <- -(wld_rp + as.vector(dat_s_m %*% new_beta2)) / pay_rp
}
WLD_WTA_ALL[i,1] <- mean(wta_vec,na.rm = TRUE)
WLD_WTA_ALL[i,2] <- quantile(wta_vec, 0.025,na.rm = TRUE)
WLD_WTA_ALL[i,3] <- quantile(wta_vec, 0.975,na.rm = TRUE)
}
WLD_WTA_ALL
